<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% extends "base.html" %}
{% block title %}MY |{% endblock title %}
{% block content %}
<div class="container">
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card text-white bg-primary mb-3">
                <div class="card-body d-flex align-items-center justify-content-between">
                    <div>
                        <h5 class="card-title">Total Revenue</h5>
                        <h3>‚Çπ {{ total_revenue }}</h3>
                    </div>
                    <div class="icon-box">üí∞</div>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card text-white bg-success mb-3">
                <div class="card-body d-flex align-items-center justify-content-between">
                    <div>
                        <h5 class="card-title">Total Stock</h5>
                        <h3>{{ total_stock }} Units</h3>
                    </div>
                    <div class="icon-box">üì¶</div>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card text-white bg-danger mb-3">
                <div class="card-body d-flex align-items-center justify-content-between">
                    <div>
                        <h5 class="card-title">Low Stock Alerts</h5>
                        <h3>{{ low_stock_count }} Items</h3>
                    </div>
                    <div class="icon-box">‚ö†Ô∏è</div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-8">
            <div class="card p-3 bg-light text-dark">
                <h5 class="card-title text-center mb-3">üìà Monthly Sales Trend</h5>
                <div style="height: 400px;">
                    <canvas id="salesChart"></canvas>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card p-3 bg-light text-dark">
                <h5 class="card-title text-center mb-3"> Top Categories</h5>
                <div style="height: 300px;">
                    <canvas id="categoryChart"></canvas>
                </div>
            </div>
        </div>
    </div>

</div>

<script>
    // Views.py se data receive karna
    // 'safe' filter lagana zaroori hai taki JSON string break na ho
    const trendLabels = JSON.parse('{{ labels_trend|safe }}');
    const trendData = JSON.parse('{{ data_trend|safe }}');
    const catLabels = JSON.parse('{{ labels_cat|safe }}');
    const catData = JSON.parse('{{ data_cat|safe }}');

    // 1. Line Chart Config (Sales Trend)
    new Chart(document.getElementById('salesChart'), {
        type: 'line',
        data: {
            labels: trendLabels,
            datasets: [{
                label: 'Sales (‚Çπ)',
                data: trendData,
                borderColor: '#0d6efd', // Blue
                backgroundColor: 'rgba(13, 110, 253, 0.1)',
                borderWidth: 2,
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false
        }
    });

    // 2. Doughnut Chart Config (Categories)
    new Chart(document.getElementById('categoryChart'), {
        type: 'doughnut',
        data: {
            labels: catLabels,
            datasets: [{
                data: catData,
                backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF'],
                hoverOffset: 4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false
        }
    });
</script>
{% endblock content %}